<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>The Salty Sip - Professional Shift</title>
    <style>
        :root {
            --sand: #f2d2a9;
            --ocean: #4fa4b8;
            --wood: #6d4c41;
            --night-sky: #1a237e;
            --lamp-glow: #fff59d;
        }

        body {
            margin: 0; padding: 0;
            font-family: 'Segoe UI', sans-serif;
            background-color: #333;
            display: flex; justify-content: center; align-items: center;
            height: 100vh; overflow: hidden;
        }

        /* --- Mobile Landscape Lock --- */
        @media screen and (orientation: portrait) {
            #landscape-notice { display: flex !important; }
        }
        #landscape-notice {
            position: fixed; top: 0; left: 0; width: 100%; height: 100%;
            background: #222; color: white; z-index: 9999;
            display: none; flex-direction: column; justify-content: center; align-items: center;
            text-align: center;
        }

        #game-container {
            position: relative;
            width: 900px; height: 600px;
            background: linear-gradient(to bottom, #87ceeb 0%, #4fa4b8 50%, var(--sand) 100%);
            border: 8px solid #222; border-radius: 12px;
            overflow: hidden; transition: background 5s ease;
        }

        .night-mode {
            background: linear-gradient(to bottom, #1a237e 0%, #283593 50%, #3e2723 100%) !important;
        }

        /* --- UI & Recipe Board --- */
        #ui-layer {
            position: absolute; top: 10px; left: 10px; right: 10px;
            display: flex; justify-content: space-between; z-index: 100;
        }

        .stat-box {
            background: rgba(255, 255, 255, 0.9);
            padding: 8px 15px; border-radius: 10px;
            font-weight: bold; border: 2px solid var(--wood);
        }

        #recipe-board {
            position: absolute; left: 10px; top: 70px;
            background: rgba(255, 249, 196, 0.95);
            padding: 10px; border: 3px solid #fbc02d;
            border-radius: 8px; font-size: 0.85rem;
            width: 180px; max-height: 250px;
            overflow-y: auto; z-index: 50;
            box-shadow: 4px 4px 0 rgba(0,0,0,0.2);
        }

        #tray-display {
            position: absolute; bottom: 195px; left: 50%;
            transform: translateX(-50%);
            background: rgba(255,255,255,0.8);
            padding: 5px 15px; border-radius: 20px;
            font-size: 0.9rem; font-weight: bold; border: 2px dashed #666;
            z-index: 30;
        }

        /* --- Entities --- */
        #bar-counter {
            position: absolute; bottom: 0; width: 100%; height: 180px;
            background-color: var(--wood); border-top: 12px solid #5d4037; z-index: 10;
        }

        .customer { position: absolute; bottom: 180px; width: 80px; transition: left 1s linear; text-align: center; }
        .speech-bubble {
            background: white; border-radius: 8px; padding: 5px;
            position: absolute; top: -75px; width: 110px; left: -15px;
            font-size: 11px; border: 2px solid #333;
        }

        .patience-bar {
            position: absolute; top: -15px; left: 10px; width: 60px; height: 6px;
            background: #eee; border: 1px solid #333;
        }
        .patience-fill { height: 100%; background: #4caf50; width: 100%; transition: width 0.3s; }

        .mess { position: absolute; bottom: 190px; cursor: pointer; animation: bounce 1s infinite; z-index: 15; }

        /* --- Controls --- */
        #controls {
            position: absolute; bottom: 10px; left: 50%; transform: translateX(-50%);
            display: flex; flex-wrap: wrap; justify-content: center; gap: 6px; z-index: 20; width: 90%;
        }
        button {
            padding: 6px 10px; cursor: pointer; border: none; border-radius: 4px;
            font-weight: bold; box-shadow: 0 3px 0 #999;
        }
        button:active { transform: translateY(2px); box-shadow: none; }

        /* --- End Screen --- */
        #results-screen {
            position: absolute; inset: 0; background: rgba(0,0,0,0.9);
            color: white; display: none; flex-direction: column;
            justify-content: center; align-items: center; z-index: 1000;
        }

        .lantern {
            position: absolute; top: 150px; width: 30px; height: 40px;
            fill: var(--lamp-glow); display: none; filter: drop-shadow(0 0 10px gold);
        }

        @keyframes bounce { 0%, 100% { transform: translateY(0); } 50% { transform: translateY(-8px); } }
    </style>
</head>
<body>

<div id="landscape-notice">
    <h2>Please Rotate Your Device</h2>
    <p>This bar works best in Landscape mode!</p>
</div>

<div id="game-container">
    <svg style="position:absolute; width:100%; height:100%">
        <circle id="sun-moon" cx="800" cy="80" r="40" fill="#fff176" />
        <path d="M0 350 Q 225 320 450 350 T 900 350 V 600 H 0 Z" fill="#4fa4b8" />
        <g transform="translate(40, 280)">
            <rect x="15" y="20" width="12" height="120" fill="#795548" />
            <path d="M21 20 Q -30 -20 -50 20 M21 20 Q 21 -40 70 10 M21 20 Q 60 -20 21 -50" stroke="#2e7d32" stroke-width="18" fill="none" />
        </g>
    </svg>

    <svg class="lantern" style="left: 200px;"><rect width="20" height="30" rx="5"/></svg>
    <svg class="lantern" style="left: 650px;"><rect width="20" height="30" rx="5"/></svg>

    <div id="ui-layer">
        <div class="stat-box">Tips: $<span id="score">0</span> <small>(x<span id="combo">1</span>)</small></div>
        <div class="stat-box">Shift Ends: <span id="shift-timer">120</span>s</div>
    </div>

    <div id="recipe-board">
        <strong>üìã DRINK MENU</strong><hr>
        ‚Ä¢ Mojito: Rum, Soda, Lime<br>
        ‚Ä¢ Ti Punch: Rum, Lime<br>
        ‚Ä¢ Sparkle: Soda, Lime, Ice<br>
        ‚Ä¢ Cuba Libre: Rum, Soda, Lemon<br>
        <br><strong>üçî FOOD MENU</strong><hr>
        ‚Ä¢ Fish&Chips: Fish, Fries<br>
        ‚Ä¢ Seafood: Fish, Shrimp, Lemon<br>
        ‚Ä¢ Fried Shrimp: Shrimp, Fries<br>
        ‚Ä¢ Surf & Turf: Fish, Shrimp, Lime
    </div>

    <div id="tray-display">Tray: <span id="tray-items">Empty</span></div>
    <div id="customer-area"></div>
    <div id="bar-counter"></div>

    <div id="controls">
        <button style="background:#bbdefb" onclick="addIngredient('Rum')">Rum</button>
        <button style="background:#bbdefb" onclick="addIngredient('Soda')">Soda</button>
        <button style="background:#bbdefb" onclick="addIngredient('Lime')">Lime</button>
        <button style="background:#bbdefb" onclick="addIngredient('Ice')">Ice</button>
        <button style="background:#c8e6c9" onclick="addIngredient('Fish')">Fish</button>
        <button style="background:#c8e6c9" onclick="addIngredient('Fries')">Fries</button>
        <button style="background:#c8e6c9" onclick="addIngredient('Shrimp')">Shrimp</button>
        <button style="background:#c8e6c9" onclick="addIngredient('Lemon')">Lemon</button>
        <div style="flex-basis: 100%; height: 5px;"></div>
        <button style="background:#81c784; padding: 10px 20px" onclick="serveOrder()">SERVE ORDER</button>
        <button style="background:#ef5350; color:white;" onclick="resetMix()">DUMP</button>
    </div>

    <div id="results-screen">
        <h1>Shift Complete!</h1>
        <p>Your Total Tips: $<span id="final-score">0</span></p>
        <button onclick="location.reload()" style="background:white; color:black; padding: 15px 30px; font-size: 1.2rem;">Start New Day</button>
    </div>
</div>

<script>
    const recipes = {
        'Lime,Rum,Soda': 'Mojito', 'Lime,Rum': 'Ti Punch', 'Ice,Lime,Soda': 'Sparkle',
        'Lemon,Rum,Soda': 'Cuba Libre', 'Fish,Fries': 'Fish&Chips',
        'Fish,Lemon,Shrimp': 'Seafood', 'Fries,Shrimp': 'Fried Shrimp', 'Fish,Lime,Shrimp': 'Surf & Turf'
    };

    let score = 0;
    let combo = 1;
    let comboTimer = null;
    let currentMix = [];
    let shiftTime = 120; // 2 minutes shift
    let seats = [
        { x: 220, occupied: false, customer: null, mess: false },
        { x: 420, occupied: false, customer: null, mess: false },
        { x: 620, occupied: false, customer: null, mess: false }
    ];

    const customerSVG = (color) => `
        <svg viewBox="0 0 64 64" width="70">
            <circle cx="32" cy="20" r="15" fill="${color}" class="skin" />
            <path d="M15 60 Q 32 30 49 60" fill="#37474f" />
            <circle cx="27" cy="18" r="2" />
            <circle cx="37" cy="18" r="2" />
        </svg>`;

    function addIngredient(ing) {
        if (currentMix.length >= 4) return;
        currentMix.push(ing);
        document.getElementById('tray-items').innerText = currentMix.join(' + ');
    }

    function resetMix() {
        currentMix = [];
        document.getElementById('tray-items').innerText = "Empty";
    }

    function spawnCustomer() {
        const freeSeatIndex = seats.findIndex(s => !s.occupied && !s.mess);
        if (freeSeatIndex === -1 || shiftTime < 10) return;

        const seat = seats[freeSeatIndex];
        seat.occupied = true;
        const keys = Object.keys(recipes);
        const targetOrder = keys[Math.floor(Math.random() * keys.length)];
        
        const customerDiv = document.createElement('div');
        customerDiv.className = 'customer';
        customerDiv.style.left = '-100px';
        customerDiv.innerHTML = `
            <div class="speech-bubble">One <b>${recipes[targetOrder]}</b>!</div>
            <div class="patience-bar"><div class="patience-fill" id="p-bar-${freeSeatIndex}"></div></div>
            <div class="svg-container">${customerSVG('#ffccbc')}</div>
        `;
        
        document.getElementById('customer-area').appendChild(customerDiv);
        seat.customer = { el: customerDiv, order: targetOrder, patience: 100 };
        setTimeout(() => { customerDiv.style.left = seat.x + 'px'; }, 100);
    }

    function serveOrder() {
        const mixString = currentMix.sort().join(',');
        let success = false;

        seats.forEach((seat, index) => {
            if (seat.occupied && !success && mixString === seat.customer.order) {
                updateScore(20 * combo);
                bumpCombo();
                handleCustomerLeave(index, "Perfect!");
                success = true;
            }
        });
        resetMix();
    }

    function bumpCombo() {
        combo++;
        document.getElementById('combo').innerText = combo;
        clearTimeout(comboTimer);
        comboTimer = setTimeout(() => { combo = 1; document.getElementById('combo').innerText = combo; }, 5000);
    }

    function updateScore(val) {
        score += val;
        document.getElementById('score').innerText = score;
    }

    function handleCustomerLeave(index, msg) {
        const seat = seats[index];
        if (!seat.customer) return;
        const el = seat.customer.el;
        el.querySelector('.speech-bubble').innerText = msg;
        setTimeout(() => {
            el.style.left = '1000px';
            setTimeout(() => {
                el.remove(); seat.occupied = false; seat.customer = null; createMess(index);
            }, 1000);
        }, 800);
    }

    function createMess(index) {
        const seat = seats[index];
        seat.mess = true;
        const messDiv = document.createElement('div');
        messDiv.className = 'mess';
        messDiv.style.left = (seat.x + 15) + 'px';
        messDiv.innerHTML = '<svg width="40" height="40"><circle cx="20" cy="20" r="15" fill="rgba(255,255,255,0.5)" stroke="#333" stroke-width="2"/><path d="M10 10 L30 30" stroke="red" stroke-width="2"/></svg><br><small>CLEAN</small>';
        messDiv.onclick = () => {
            messDiv.remove(); seat.mess = false; updateScore(5);
        };
        document.getElementById('customer-area').appendChild(messDiv);
    }

    // Main Clock
    const gameClock = setInterval(() => {
        shiftTime--;
        document.getElementById('shift-timer').innerText = shiftTime;

        // Visual Transitions
        if (shiftTime === 60) {
            document.getElementById('game-container').classList.add('night-mode');
            document.getElementById('sun-moon').setAttribute('fill', '#e0e0e0');
            document.querySelectorAll('.lantern').forEach(l => l.style.display = 'block');
        }

        // Logic
        seats.forEach((seat, idx) => {
            if (seat.occupied && seat.customer) {
                seat.customer.patience -= 1.5;
                const bar = document.getElementById(`p-bar-${idx}`);
                if (bar) {
                    bar.style.width = seat.customer.patience + '%';
                    if (seat.customer.patience < 30) seat.customer.el.querySelector('.skin').setAttribute('fill', '#ef9a9a');
                }
                if (seat.customer.patience <= 0) handleCustomerLeave(idx, "Too slow!");
            }
        });

        if (Math.random() < 0.3) spawnCustomer();

        if (shiftTime <= 0) {
            clearInterval(gameClock);
            document.getElementById('results-screen').style.display = 'flex';
            document.getElementById('final-score').innerText = score;
        }
    }, 1000);

</script>
</body>
</html>